/*
 * This is sample code generated by rpcgen.
 * These are only templates and you can use them
 * as a guideline for developing your own functions.
 */

#include<iostream>
#include "rpc_db.hpp"



unsigned long current_session_key = 1;

#define LOGIN_LIST_CAPACITY 10
static LoginCredentials* loggingList;
int loggingListSize = 0;

int check_if_logged(char* username) {
	for (int i = 0; i < loggingListSize; i++) {
		if (strcmp(username, loggingList[i].username) == 0) {
			return 1;
		}
	}
	return 0;
}

LoginCredentials *
login_1_svc(char **argp, struct svc_req *rqstp)
{
	static LoginCredentials  result;

	/*
	 * insert server code here
	 */

	std::cout << "Test" << std::endl;
	printf("Se conecteaza %s\n", *argp);
	if (check_if_logged(*argp)) {
		printf("Already logged\n");
		return (LoginCredentials *) NULL;
	}

	loggingList = (LoginCredentials*)malloc(LOGIN_LIST_CAPACITY * sizeof(LoginCredentials));

	result.username = (char*)malloc(sizeof(30));
	
	strcpy(result.username, *argp);

	result.session_key = current_session_key++;


	loggingList[loggingListSize++] = result;




	return &result;
}

void *
logout_1_svc(void *argp, struct svc_req *rqstp)
{
	static char * result;

	/*
	 * insert server code here
	 */

	return (void *) &result;
}

void *
load_1_svc(void *argp, struct svc_req *rqstp)
{
	static char * result;

	/*
	 * insert server code here
	 */

	return (void *) &result;
}

void *
store_1_svc(void *argp, struct svc_req *rqstp)
{
	static char * result;

	/*
	 * insert server code here
	 */

	return (void *) &result;
}

void *
add_1_svc(void *argp, struct svc_req *rqstp)
{
	static char * result;

	/*
	 * insert server code here
	 */

	return (void *) &result;
}

void *
del_1_svc(void *argp, struct svc_req *rqstp)
{
	static char * result;

	/*
	 * insert server code here
	 */

	return (void *) &result;
}

void *
update_1_svc(void *argp, struct svc_req *rqstp)
{
	static char * result;

	/*
	 * insert server code here
	 */

	return (void *) &result;
}

void *
read_1_svc(void *argp, struct svc_req *rqstp)
{
	static char * result;

	/*
	 * insert server code here
	 */

	return (void *) &result;
}

void *
get_stat_1_svc(void *argp, struct svc_req *rqstp)
{
	static char * result;

	/*
	 * insert server code here
	 */

	return (void *) &result;
}

void *
get_stat_all_1_svc(void *argp, struct svc_req *rqstp)
{
	static char * result;

	/*
	 * insert server code here
	 */

	return (void *) &result;
}
